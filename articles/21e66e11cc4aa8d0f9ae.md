---
title: "GitHub Actions ã§ SSH ãƒ‡ãƒãƒƒã‚°ï¼ (debugging-with-tmate)"
emoji: "ğŸ› ï¸"
type: "tech"
topics: ["github", "githubactions", "ssh", "debug", "tmate"]
published: true
---

# tl;dr

å¤±æ•—ã—ãŸã‚¹ãƒ†ãƒƒãƒ—ã®æ¬¡ã« [#ã‚¹ãƒ‹ãƒšãƒƒãƒˆ](#ã‚¹ãƒ‹ãƒšãƒƒãƒˆ) ã‚’è²¼ã£ã¦ workflow ç™ºç«ã—ã¾ã™ã€‚ãŠã‚ã‚Šï¼

# å°å…¥

ã¿ãªã•ã‚“ã€GitHub Actions ä½¿ã£ã¦ã„ã¾ã™ã‹ã€‚ä»– CI
ã‚µãƒ¼ãƒ“ã‚¹ã¨æ¯”ã¹ã¦ã„ãã¤ã‹æ©Ÿèƒ½ãŒé–“ã«åˆã£ã¦ãªãã¦ç§»è¡Œã§ããªã„ã€ã¿ãŸã„ãªäººãŸã¡ã‚‚çµæ§‹ã„ã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯ Circle CI ãªã©ã§ã¯ã§ãã¦ã„ãŸ
SSH ãƒ‡ãƒãƒƒã‚°ãŒã§ãã‚‹ã‚ˆã•ãã†ãª Actions ã‚’ã¿ã¤ã‘ãŸã®ã§ã€ãã®æ–¹æ³•ã‚’ç´¹ä»‹ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ï¼ˆæŠ€è¡“çš„ã«ã¯æ˜”ã‹ã‚‰ã§ããŸãŒã€ãã®æ±ºå®šçš„ãªæ–¹æ³•ãŒãªã‹ã£ãŸã€‚ï¼‰

ä»Šå›ç´¹ä»‹ã™ã‚‹ Actions ã¯
[debugging-with-tmate](https://github.com/marketplace/actions/debugging-with-tmate)
ã§ã™ã€‚ä»¥ä¸‹ã§ã¯ãã®ãŠã™ã™ã‚ã®ä½¿ã„æ–¹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

https://github.com/marketplace/actions/debugging-with-tmate

# SSH ãƒ‡ãƒãƒƒã‚°ã®ãŠã™ã™ã‚æ‰‹é †

1. ã‚ã‚‹ãƒ–ãƒ©ãƒ³ãƒã§ã®ã€ã‚ã‚‹ workflow ã®ã‚ã‚‹ step ãŒå¤±æ•—ã—ãŸ
2. ãã®ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚‹
3. ãã® step ã®æ¬¡ã«
   [debugging-with-tmate](https://github.com/marketplace/actions/debugging-with-tmate)
   ã‚’ `if: ${{ always() }}` ã§å·®ã—è¾¼ã‚€ã€‚å¿…è¦ã§ã‚ã‚Œã° `on:` ã‚’æ›¸ãæ›ãˆã¦ workflow ãŒç™ºç«ã™ã‚‹ç”¨ã«ã™ã‚‹ã€‚
4. push ã—ã¦ workflow ã‚’å‹•ã‹ã™ã€‚å¤±æ•—ã—ãŸ step ã®æ¬¡ã§æ­¢ã¾ã‚‹ã€‚
5. Actions ã®ãƒ­ã‚°ãŒ SSH ã™ã‚‹æ–¹æ³•ã‚’æ•™ãˆã¦ãã‚Œã‚‹ã®ã§ã€ãã‚Œã§ SSH ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚
   - `ssh *****@***.tmate.io` ã™ã‚‹ã‹ã€ Web ä¸Šã§ `https://tmate.io/*****`
     ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹æ–¹æ³•ãŒã‚ã‚‹ã€‚ãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã«å¾“ãˆã°ã„ã„ã€‚
6. ğŸ’ªãƒ‡ãƒãƒƒã‚°ã€åŸå› ç©¶æ˜
7. ä½œæ¥­ãŒçµ‚ã‚ã£ãŸã‚‰ã€ `touch continue` ( `cd` ã—ã¦ãªã„å ´åˆ ) ã‹ `sudo touch /continue` ã§
   workflow ã‚’ç¶šè¡Œã•ã›ã‚‹ã‹ã€Web ä¸Šã‹ã‚‰ Cancel Workflow ã™ã‚‹ã€‚

# ã‚¹ãƒ‹ãƒšãƒƒãƒˆ

```yaml
- name: Debug
      if: ${{ always() }}
      uses: mxschmitt/action-tmate@v3
```

:::message å¿…è¦ã§ã‚ã‚Œã°
[debugging-with-tmate](https://github.com/marketplace/actions/debugging-with-tmate)
ã®æœ€æ–°ç‰ˆãŒã§ã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚ :::

# Web ä¸Šã§ã®æ‰‹é †

1. ã‚ã‚‹ workflow ã®ã‚ã‚‹ step ãŒå¤±æ•—ã—ãŸ
   ![](https://storage.googleapis.com/zenn-user-upload/stbyh426xv1u0giziy0elza08gu8)
2. ãã®ãƒ–ãƒ©ãƒ³ãƒã‹ã‚‰ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’åˆ‡ã‚‹
   ![](https://storage.googleapis.com/zenn-user-upload/hqtlp5bbfodd3qf4elsi57pnnrc5)
3. ãã® step ã®æ¬¡ã«
   [debugging-with-tmate](https://github.com/marketplace/actions/debugging-with-tmate)
   ã‚’å·®ã—è¾¼ã‚€ã€‚
   1. ![](https://storage.googleapis.com/zenn-user-upload/c9ksdiz1c1h4en5tlsl8rftarc6r)
   2. ![](https://storage.googleapis.com/zenn-user-upload/midhae1x830krmwoydetmhva2sle)
   3. é–“é•ã£ã¦ãƒãƒ¼ã‚¸ã—ãªã„ã‚ˆã†ã« draft ã«ã—ã¦ãŠã“ã†ã€‚
      ![](https://storage.googleapis.com/zenn-user-upload/gzde45bg60zunrhu2iea0twrkuyv)
4. ![](https://storage.googleapis.com/zenn-user-upload/zwdnjxnc08s5rj5ee0bltdu4pb8m)
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒãã®ã¾ã¾ãƒ¯ãƒ³ã‚¿ã‚¤ãƒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã‚ˆã†ã€‚ä»–äººã«æ•™ãˆãªã„ã‚ˆã†ã«ï¼
   ![](https://storage.googleapis.com/zenn-user-upload/6nwklfi9rnmqwa26od8hw6bjlsbs)
6. ä¾‹ãˆã° Web ç‰ˆã§å…¥ã‚‹ã¨ã“ã‚“ãªã‹ã‚“ã˜ã€‚ ( checkout ã™ã‚‰ã—ã¦ãªãã¦ãªã«ã‚‚ãªã„ã‘ã©ï¼ )
   ![](https://storage.googleapis.com/zenn-user-upload/xie0zaatbjasnj9o76tsvf2yu9ep)

çµ‚ã‚ã‚‹ã¨ãã¯ã€`sudo touch /continue` ã‹ã€ `cd` ã—ã¦ã„ãªã‘ã‚Œã° `touch continue` ã§ workflow
ã‚’ç¶šè¡Œã§ãã¾ã™ã€‚ GitHub ã®ãƒªã‚½ãƒ¼ã‚¹ ( ã¨ private ãªã‚‰æ™‚é–“ ) ã‚’æ¶ˆè²»éããªã„ãŸã‚ã«ã‚‚ã€ä½œæ¥­ãŒçµ‚ã‚ã£ãŸã‚‰ä¸Šè¨˜ã®ã‚ˆã†ã«ã™ã‚‹ã‹ã€Webä¸Šã§
Cancel Workflow ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

ã©ã“ã® step ã§è½ã¡ã‚‹ã‹ã‚ã‹ã‚‰ãªã„å ´åˆã¨ã‹ã¯å„ã‚¹ãƒ†ãƒƒãƒ—ã«æŒŸã¿è¾¼ã‚ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- private repo ãªã‚‰ã€ã™ã¹ã¦ã®æƒ…å ±ãŒè¦‹ã‚Œã¦ã—ã¾ã†ã®ã§ä»–äººã« ssh å…ˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è¦‹ã›ãªã„ã“ã¨ã€çµ‚ã‚ã£ãŸã‚‰ã™ãçµ‚äº†ã•ã›ã‚‹ã“ã¨ã§ã™ã€‚
- public ã§ã‚‚ã€SECRET ãŒç›´æ¥è¦‹ã‚Œã‚‹ã£ã¦ã“ã¨ã¯ãªã•ãã†ã§ã™ãŒã€SECRET ã«ã‚‚ã¨ã¥ã„ãŸ step ã®ã‚ã¨ã«å‹•ã‹ã›ã‚‹ã®ã§ã€è‡ªåˆ†ã§
  ~~ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦~~
  [duplicate ã—ã¦](https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows)
  (ãƒ•ã‚©ãƒ¼ã‚¯ã ã¨ private ã«ã§ããªãã¦ã¿ã‚“ãªã§ ssh ã§ãã‚‹åœ°ç„ã«ãªã‚Šãã†ã€)
  ãŸã‚ã—ã¦ã­ã€ã¨ã™ã‚‹ã®ãŒæ­£ã—ã„ã‹ãªã€‚ãƒªãƒã‚¸ãƒˆãƒªã‚ªãƒ¼ãƒŠãƒ¼å«ã‚ã¦ã€‚ã‚ã‚“ã©ãã•ã„ãªâ€¦ä»•æ–¹ãªã—â€¦
- [tmate.io](https://tmate.io) ã¯ DigitalOcean ã«ã‚ˆã£ã¦ãƒ›ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹ã€‚
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã® Actions ãªã®ã§å¿…è¦ãªç¯„å›²ã§ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

# ã¾ã¨ã‚

GHA æœ€é«˜ï¼
